package com.challenge.enigma.utilities;

import static org.springframework.test.web.client.match.MockRestRequestMatchers.*;
import static org.springframework.test.web.client.response.MockRestResponseCreators.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.HttpMethod;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.test.web.client.MockRestServiceServer;
import org.springframework.web.client.RestTemplate;
import com.challenge.enigma.models.Character;
import com.challenge.enigma.models.CharacterList;
import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import java.util.LinkedList;
import java.util.List;

@RunWith(SpringJUnit4ClassRunner.class)
@SpringBootTest
public class SpeciesAPIUtilityTest {

    @Autowired
    RestTemplate restTemplate;

    @Autowired
    private SpeciesAPIUtility speciesService;

    private MockRestServiceServer mockServer;

    @Before
    public void setUp() {
        mockServer = MockRestServiceServer.createServer(restTemplate);
    }

    @Test
    public void speciesSearchTest() {
        mockServer.expect(requestTo("http://stapi.co/api/v1/rest/character/search"))
                .andExpect(method(HttpMethod.POST))
                .andExpect(content().contentType(MediaType.APPLICATION_FORM_URLENCODED))
                .andExpect(content().string("title=uhura&name=uhura"))
                .andRespond(withStatus(HttpStatus.OK)
                        .body("{\"page\":{\"pageNumber\":0,\"pageSize\":50,\"numberOfElements\":3,\"totalElements\":3,\"totalPages\":1,\"firstPage\":true,\"lastPage\":true},\"sort\":{\"clauses\":[]},\"characters\":[{\"uid\":\"CHMA0000068639\",\"name\":\"Nyota Uhura\",\"gender\":\"F\",\"yearOfBirth\":2239,\"monthOfBirth\":null,\"dayOfBirth\":null,\"placeOfBirth\":null,\"yearOfDeath\":null,\"monthOfDeath\":null,\"dayOfDeath\":null,\"placeOfDeath\":null,\"height\":null,\"weight\":null,\"deceased\":null,\"bloodType\":null,\"maritalStatus\":\"SINGLE\",\"serialNumber\":null,\"hologramActivationDate\":null,\"hologramStatus\":null,\"hologramDateStatus\":null,\"hologram\":false,\"fictionalCharacter\":false,\"mirror\":false,\"alternateReality\":false},{\"uid\":\"CHMA0000023576\",\"name\":\"Nyota Uhura\",\"gender\":\"F\",\"yearOfBirth\":2239,\"monthOfBirth\":null,\"dayOfBirth\":null,\"placeOfBirth\":null,\"yearOfDeath\":2268,\"monthOfDeath\":null,\"dayOfDeath\":null,\"placeOfDeath\":null,\"height\":null,\"weight\":null,\"deceased\":null,\"bloodType\":null,\"maritalStatus\":\"SINGLE\",\"serialNumber\":null,\"hologramActivationDate\":null,\"hologramStatus\":null,\"hologramDateStatus\":null,\"hologram\":false,\"fictionalCharacter\":false,\"mirror\":true,\"alternateReality\":false},{\"uid\":\"CHMA0000115364\",\"name\":\"Nyota Uhura\",\"gender\":\"F\",\"yearOfBirth\":2233,\"monthOfBirth\":null,\"dayOfBirth\":null,\"placeOfBirth\":null,\"yearOfDeath\":null,\"monthOfDeath\":null,\"dayOfDeath\":null,\"placeOfDeath\":null,\"height\":null,\"weight\":null,\"deceased\":null,\"bloodType\":null,\"maritalStatus\":null,\"serialNumber\":null,\"hologramActivationDate\":null,\"hologramStatus\":null,\"hologramDateStatus\":null,\"hologram\":false,\"fictionalCharacter\":false,\"mirror\":false,\"alternateReality\":true}]}")
                        .contentType(MediaType.APPLICATION_JSON));
        CharacterList characterList = speciesService.getCharacterList("uhura");
        Assert.assertNotNull(characterList);
        Assert.assertEquals(3, characterList.getCharacters().size());
        mockServer.verify();
    }

    @Test
    public void speciesFindSpeciesTest() {
        mockServer.expect(requestTo("http://stapi.co/api/v1/rest/character?uid=CHMA0000068639"))
                .andExpect(method(HttpMethod.GET))
                .andRespond(withStatus(HttpStatus.OK)
                        .body("{\"character\":{\"uid\":\"CHMA0000068639\",\"name\":\"Nyota Uhura\",\"gender\":\"F\",\"yearOfBirth\":2239,\"monthOfBirth\":null,\"dayOfBirth\":null,\"placeOfBirth\":null,\"yearOfDeath\":null,\"monthOfDeath\":null,\"dayOfDeath\":null,\"placeOfDeath\":null,\"height\":null,\"weight\":null,\"deceased\":null,\"bloodType\":null,\"maritalStatus\":\"SINGLE\",\"serialNumber\":null,\"hologramActivationDate\":null,\"hologramStatus\":null,\"hologramDateStatus\":null,\"hologram\":false,\"fictionalCharacter\":false,\"mirror\":false,\"alternateReality\":false,\"performers\":[{\"uid\":\"PEMA0000006026\",\"name\":\"Nichelle Nichols\",\"birthName\":\"Grace Dell Nichols\",\"gender\":\"F\",\"dateOfBirth\":\"1932-12-28\",\"placeOfBirth\":\"Robbins, Illinois, USA\",\"dateOfDeath\":null,\"placeOfDeath\":null,\"animalPerformer\":false,\"disPerformer\":false,\"ds9Performer\":true,\"entPerformer\":false,\"filmPerformer\":true,\"standInPerformer\":false,\"stuntPerformer\":false,\"tasPerformer\":true,\"tngPerformer\":false,\"tosPerformer\":true,\"videoGamePerformer\":true,\"voicePerformer\":false,\"voyPerformer\":false}],\"episodes\":[{\"uid\":\"EPMA0000000477\",\"title\":\"For the World is Hollow and I Have Touched the Sky\",\"titleGerman\":\"Der verirrte Planet\",\"titleItalian\":\"Ho toccato il cielo\",\"titleJapanese\":\"宇宙に漂う惑星型宇宙船\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001734\",\"title\":\"TOS Season 3\"},\"seasonNumber\":3,\"episodeNumber\":10,\"productionSerialNumber\":\"60043-65\",\"featureLength\":false,\"stardateFrom\":5476.3,\"stardateTo\":5476.3,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1968-11-08\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000457\",\"title\":\"A Private Little War\",\"titleGerman\":\"Der erste Krieg\",\"titleItalian\":null,\"titleJapanese\":\"カヌーソ・ノナの魔力\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001733\",\"title\":\"TOS Season 2\"},\"seasonNumber\":2,\"episodeNumber\":16,\"productionSerialNumber\":\"60345\",\"featureLength\":false,\"stardateFrom\":4211.4,\"stardateTo\":4211.4,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1968-02-02\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000464\",\"title\":\"Patterns of Force\",\"titleGerman\":\"Schablonen der Gewalt\",\"titleItalian\":null,\"titleJapanese\":\"エコス・ナチスの恐怖\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001733\",\"title\":\"TOS Season 2\"},\"seasonNumber\":2,\"episodeNumber\":23,\"productionSerialNumber\":\"60352\",\"featureLength\":false,\"stardateFrom\":null,\"stardateTo\":null,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1968-02-16\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000003453\",\"title\":\"The Slaver Weapon\",\"titleGerman\":\"Das Geheimnis der Stasis-Box\",\"titleItalian\":null,\"titleJapanese\":null,\"series\":{\"uid\":\"SEMA0000034504\",\"title\":\"Star Trek: The Animated Series\"},\"season\":{\"uid\":\"SAMA0000000767\",\"title\":\"TAS Season 1\"},\"seasonNumber\":1,\"episodeNumber\":14,\"productionSerialNumber\":\"22011\",\"featureLength\":false,\"stardateFrom\":4187.3,\"stardateTo\":4187.3,\"yearFrom\":2269,\"yearTo\":2269,\"usAirDate\":\"1973-12-15\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000466\",\"title\":\"The Omega Glory\",\"titleGerman\":\"Das Jahr des roten Vogels\",\"titleItalian\":null,\"titleJapanese\":\"細菌戦争の果て\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001733\",\"title\":\"TOS Season 2\"},\"seasonNumber\":2,\"episodeNumber\":25,\"productionSerialNumber\":\"60354\",\"featureLength\":false,\"stardateFrom\":null,\"stardateTo\":null,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1968-03-01\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000468\",\"title\":\"Spectre of the Gun\",\"titleGerman\":\"Wild West im Weltraum\",\"titleItalian\":null,\"titleJapanese\":\"危機一髪！OK牧場の決闘\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001734\",\"title\":\"TOS Season 3\"},\"seasonNumber\":3,\"episodeNumber\":1,\"productionSerialNumber\":\"60043-56\",\"featureLength\":false,\"stardateFrom\":4385.3,\"stardateTo\":4385.3,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1968-10-25\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000463\",\"title\":\"Return to Tomorrow\",\"titleGerman\":\"Geist sucht Körper\",\"titleItalian\":null,\"titleJapanese\":\"地底160キロのエネルギー\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001733\",\"title\":\"TOS Season 2\"},\"seasonNumber\":2,\"episodeNumber\":22,\"productionSerialNumber\":\"60351\",\"featureLength\":false,\"stardateFrom\":4768.3,\"stardateTo\":4768.3,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1968-02-09\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000470\",\"title\":\"The Paradise Syndrome\",\"titleGerman\":\"Der Obelisk\",\"titleItalian\":null,\"titleJapanese\":\"小惑星衝突コース接近中\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001734\",\"title\":\"TOS Season 3\"},\"seasonNumber\":3,\"episodeNumber\":3,\"productionSerialNumber\":\"60043-58\",\"featureLength\":false,\"stardateFrom\":4842.6,\"stardateTo\":4842.6,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1968-10-04\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000490\",\"title\":\"Requiem for Methuselah\",\"titleGerman\":\"Planet der Unsterblichen\",\"titleItalian\":\"Requiem per Matusalemme\",\"titleJapanese\":\"6200歳の恋\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001734\",\"title\":\"TOS Season 3\"},\"seasonNumber\":3,\"episodeNumber\":21,\"productionSerialNumber\":\"60043-76\",\"featureLength\":false,\"stardateFrom\":5843.7,\"stardateTo\":5843.7,\"yearFrom\":2269,\"yearTo\":2269,\"usAirDate\":\"1969-02-14\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000465\",\"title\":\"The Ultimate Computer\",\"titleGerman\":\"Computer M5\",\"titleItalian\":null,\"titleJapanese\":\"恐怖のコンピューターM-5\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001733\",\"title\":\"TOS Season 2\"},\"seasonNumber\":2,\"episodeNumber\":24,\"productionSerialNumber\":\"60353\",\"featureLength\":false,\"stardateFrom\":4729.4,\"stardateTo\":4729.4,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1968-03-08\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000006774\",\"title\":\"The Menagerie, Part I\",\"titleGerman\":\"Talos IV – Tabu, Teil I\",\"titleItalian\":null,\"titleJapanese\":\"タロス星の幻怪人・前編\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001732\",\"title\":\"TOS Season 1\"},\"seasonNumber\":1,\"episodeNumber\":15,\"productionSerialNumber\":\"6149-16A\",\"featureLength\":false,\"stardateFrom\":3012.4,\"stardateTo\":3012.4,\"yearFrom\":2254,\"yearTo\":2267,\"usAirDate\":\"1966-11-17\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000479\",\"title\":\"Plato's Stepchildren\",\"titleGerman\":\"Platons Stiefkinder\",\"titleItalian\":\"Umiliati per forza maggiore\",\"titleJapanese\":\"キロナイドの魔力\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001734\",\"title\":\"TOS Season 3\"},\"seasonNumber\":3,\"episodeNumber\":12,\"productionSerialNumber\":\"60043-67\",\"featureLength\":false,\"stardateFrom\":5784.2,\"stardateTo\":5784.2,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1968-11-22\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000006967\",\"title\":\"How Sharper Than a Serpent's Tooth\",\"titleGerman\":\"Kulkulkan – Der Mächtige\",\"titleItalian\":null,\"titleJapanese\":null,\"series\":{\"uid\":\"SEMA0000034504\",\"title\":\"Star Trek: The Animated Series\"},\"season\":{\"uid\":\"SAMA0000000768\",\"title\":\"TAS Season 2\"},\"seasonNumber\":2,\"episodeNumber\":5,\"productionSerialNumber\":\"22022\",\"featureLength\":false,\"stardateFrom\":6063.4,\"stardateTo\":6063.4,\"yearFrom\":2270,\"yearTo\":2270,\"usAirDate\":\"1974-10-05\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000480\",\"title\":\"Wink of an Eye\",\"titleGerman\":\"Was summt denn da?\",\"titleItalian\":null,\"titleJapanese\":\"惑星スカロスの高速人間\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001734\",\"title\":\"TOS Season 3\"},\"seasonNumber\":3,\"episodeNumber\":13,\"productionSerialNumber\":\"60043-68\",\"featureLength\":false,\"stardateFrom\":5710.5,\"stardateTo\":5710.5,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1968-11-29\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000006766\",\"title\":\"The Enemy Within\",\"titleGerman\":\"Kirk : 2 = ?\",\"titleItalian\":\"Il duplicato\",\"titleJapanese\":\"二人のカーク\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001732\",\"title\":\"TOS Season 1\"},\"seasonNumber\":1,\"episodeNumber\":4,\"productionSerialNumber\":\"6149-05\",\"featureLength\":false,\"stardateFrom\":1672.1,\"stardateTo\":1672.1,\"yearFrom\":2266,\"yearTo\":2266,\"usAirDate\":\"1966-10-06\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000481\",\"title\":\"That Which Survives\",\"titleGerman\":\"Gefährliche Planetengirls\",\"titleItalian\":null,\"titleJapanese\":\"無人惑星の謎\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001734\",\"title\":\"TOS Season 3\"},\"seasonNumber\":3,\"episodeNumber\":14,\"productionSerialNumber\":\"60043-69\",\"featureLength\":false,\"stardateFrom\":3113.2,\"stardateTo\":3113.2,\"yearFrom\":1969,\"yearTo\":2267,\"usAirDate\":\"1969-01-24\",\"finalScriptDate\":\"1968-09-16\"},{\"uid\":\"EPMA0000006966\",\"title\":\"Albatross\",\"titleGerman\":\"Dr. McCoy unter Anklage\",\"titleItalian\":null,\"titleJapanese\":null,\"series\":{\"uid\":\"SEMA0000034504\",\"title\":\"Star Trek: The Animated Series\"},\"season\":{\"uid\":\"SAMA0000000768\",\"title\":\"TAS Season 2\"},\"seasonNumber\":2,\"episodeNumber\":4,\"productionSerialNumber\":\"22019\",\"featureLength\":false,\"stardateFrom\":5275.6,\"stardateTo\":5276.8,\"yearFrom\":2270,\"yearTo\":2270,\"usAirDate\":\"1974-09-28\",\"finalScriptDate\":\"1974-06-27\"},{\"uid\":\"EPMA0000006955\",\"title\":\"More Tribbles, More Troubles\",\"titleGerman\":\"Mehr Trouble mit Tribbles\",\"titleItalian\":null,\"titleJapanese\":\"謎の新兵器パラライズ光線\",\"series\":{\"uid\":\"SEMA0000034504\",\"title\":\"Star Trek: The Animated Series\"},\"season\":{\"uid\":\"SAMA0000000767\",\"title\":\"TAS Season 1\"},\"seasonNumber\":1,\"episodeNumber\":5,\"productionSerialNumber\":\"22001\",\"featureLength\":false,\"stardateFrom\":5392.4,\"stardateTo\":5392.4,\"yearFrom\":2269,\"yearTo\":2269,\"usAirDate\":\"1973-10-06\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000006775\",\"title\":\"The Menagerie, Part II\",\"titleGerman\":\"Talos IV – Tabu, Teil II\",\"titleItalian\":null,\"titleJapanese\":\"タロス星の幻怪人・後編\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001732\",\"title\":\"TOS Season 1\"},\"seasonNumber\":1,\"episodeNumber\":16,\"productionSerialNumber\":\"6149-16B\",\"featureLength\":false,\"stardateFrom\":3013.1,\"stardateTo\":3013.1,\"yearFrom\":2254,\"yearTo\":2267,\"usAirDate\":\"1966-11-24\",\"finalScriptDate\":\"1966-10-07\"},{\"uid\":\"EPMA0000000459\",\"title\":\"Obsession\",\"titleGerman\":\"Tödliche Wolken\",\"titleItalian\":null,\"titleJapanese\":\"復讐！ガス怪獣\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001733\",\"title\":\"TOS Season 2\"},\"seasonNumber\":2,\"episodeNumber\":18,\"productionSerialNumber\":\"60347\",\"featureLength\":false,\"stardateFrom\":3619.2,\"stardateTo\":3619.2,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1967-12-15\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000486\",\"title\":\"The Lights of Zetar\",\"titleGerman\":\"Strahlen greifen an\",\"titleItalian\":\"Le speranze di Zetar\",\"titleJapanese\":\"消滅惑星ゼータの攻撃\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001734\",\"title\":\"TOS Season 3\"},\"seasonNumber\":3,\"episodeNumber\":18,\"productionSerialNumber\":\"60043-73\",\"featureLength\":false,\"stardateFrom\":5725.3,\"stardateTo\":5725.3,\"yearFrom\":2269,\"yearTo\":2269,\"usAirDate\":\"1969-01-31\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000069\",\"title\":\"Beyond the Farthest Star\",\"titleGerman\":\"Das körperlose Wesen\",\"titleItalian\":null,\"titleJapanese\":null,\"series\":{\"uid\":\"SEMA0000034504\",\"title\":\"Star Trek: The Animated Series\"},\"season\":{\"uid\":\"SAMA0000000767\",\"title\":\"TAS Season 1\"},\"seasonNumber\":1,\"episodeNumber\":1,\"productionSerialNumber\":\"22004\",\"featureLength\":false,\"stardateFrom\":5221.3,\"stardateTo\":5221.8,\"yearFrom\":2269,\"yearTo\":2269,\"usAirDate\":\"1973-09-08\",\"finalScriptDate\":\"1973-05-10\"},{\"uid\":\"EPMA0000006965\",\"title\":\"The Practical Joker\",\"titleGerman\":\"Wüste Scherze\",\"titleItalian\":\"Il computer si diverte\",\"titleJapanese\":null,\"series\":{\"uid\":\"SEMA0000034504\",\"title\":\"Star Trek: The Animated Series\"},\"season\":{\"uid\":\"SAMA0000000768\",\"title\":\"TAS Season 2\"},\"seasonNumber\":2,\"episodeNumber\":3,\"productionSerialNumber\":\"22021\",\"featureLength\":false,\"stardateFrom\":3183.3,\"stardateTo\":3183.3,\"yearFrom\":2270,\"yearTo\":2270,\"usAirDate\":\"1974-09-21\",\"finalScriptDate\":\"1974-05-06\"},{\"uid\":\"EPMA0000006909\",\"title\":\"The Pirates of Orion\",\"titleGerman\":\"Die Piraten von Orion\",\"titleItalian\":null,\"titleJapanese\":null,\"series\":{\"uid\":\"SEMA0000034504\",\"title\":\"Star Trek: The Animated Series\"},\"season\":{\"uid\":\"SAMA0000000768\",\"title\":\"TAS Season 2\"},\"seasonNumber\":2,\"episodeNumber\":1,\"productionSerialNumber\":\"22020\",\"featureLength\":false,\"stardateFrom\":6334.1,\"stardateTo\":6334.1,\"yearFrom\":2270,\"yearTo\":2270,\"usAirDate\":\"1974-09-07\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000006948\",\"title\":\"One of Our Planets Is Missing\",\"titleGerman\":\"Die gefährliche Wolke\",\"titleItalian\":null,\"titleJapanese\":null,\"series\":{\"uid\":\"SEMA0000034504\",\"title\":\"Star Trek: The Animated Series\"},\"season\":{\"uid\":\"SAMA0000000767\",\"title\":\"TAS Season 1\"},\"seasonNumber\":1,\"episodeNumber\":3,\"productionSerialNumber\":\"22007\",\"featureLength\":false,\"stardateFrom\":5371.3,\"stardateTo\":5371.3,\"yearFrom\":2269,\"yearTo\":2269,\"usAirDate\":\"1973-09-22\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000482\",\"title\":\"Let That Be Your Last Battlefield\",\"titleGerman\":\"Bele jagt Lokai\",\"titleItalian\":null,\"titleJapanese\":\"惑星セロンの対立\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001734\",\"title\":\"TOS Season 3\"},\"seasonNumber\":3,\"episodeNumber\":15,\"productionSerialNumber\":\"60043-70\",\"featureLength\":false,\"stardateFrom\":5730.2,\"stardateTo\":5730.2,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1969-01-10\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000006958\",\"title\":\"The Magicks of Megas-Tu\",\"titleGerman\":\"Das Geheimnis von Megas-Tu\",\"titleItalian\":\"Le magie dei Megas-Tu\",\"titleJapanese\":null,\"series\":{\"uid\":\"SEMA0000034504\",\"title\":\"Star Trek: The Animated Series\"},\"season\":{\"uid\":\"SAMA0000000767\",\"title\":\"TAS Season 1\"},\"seasonNumber\":1,\"episodeNumber\":8,\"productionSerialNumber\":\"22009\",\"featureLength\":false,\"stardateFrom\":1254.4,\"stardateTo\":1254.4,\"yearFrom\":2269,\"yearTo\":2269,\"usAirDate\":\"1973-10-27\",\"finalScriptDate\":null},{\"uid\":\"EPMA0000000485\",\"title\":\"The Mark of Gideon\",\"titleGerman\":\"Fast unsterblich\",\"titleItalian\":null,\"titleJapanese\":\"長寿惑星ギデオンの苦悩\",\"series\":{\"uid\":\"SEMA0000097474\",\"title\":\"Star Trek: The Original Series\"},\"season\":{\"uid\":\"SAMA0000001734\",\"title\":\"TOS Season 3\"},\"seasonNumber\":3,\"episodeNumber\":17,\"productionSerialNumber\":\"60043-72\",\"featureLength\":false,\"stardateFrom\":5423.4,\"stardateTo\":5423.4,\"yearFrom\":2268,\"yearTo\":2268,\"usAirDate\":\"1969-01-17\",\"finalScriptDate\":null}],\"movies\":[{\"uid\":\"MOMA0000002046\",\"title\":\"Star Trek IV: The Voyage Home\",\"mainDirector\":{\"uid\":\"STMA0000023803\",\"name\":\"Leonard Nimoy\"},\"titleBulgarian\":\"Стар Трек IV: Пътуване към вкъщи\",\"titleCatalan\":\"Star Trek IV: Missió: Salvar la Terra\",\"titleChineseTraditional\":null,\"titleGerman\":\"Star Trek IV: Zurück in die Gegenwart\",\"titleItalian\":null,\"titleJapanese\":\"スタートレック4：故郷への長い道\",\"titlePolish\":\"Star Trek IV: Powrót do Domu\",\"titleRussian\":\"Звёздный путь IV: Путь домой\",\"titleSerbian\":null,\"titleSpanish\":\"Star Trek IV: The Voyage Home\",\"stardateFrom\":null,\"stardateTo\":null,\"yearFrom\":null,\"yearTo\":null,\"usReleaseDate\":\"1986-11-26\"},{\"uid\":\"MOMA0000002044\",\"title\":\"Star Trek VI: The Undiscovered Country\",\"mainDirector\":{\"uid\":\"STMA0000015366\",\"name\":\"Nicholas Meyer\"},\"titleBulgarian\":\"Стар Трек VI: Неоткритата страна\",\"titleCatalan\":\"Star Trek VI: Aquell país desconegut\",\"titleChineseTraditional\":null,\"titleGerman\":\"Star Trek VI: Das unentdeckte Land\",\"titleItalian\":null,\"titleJapanese\":\"スタートレック6：未知の世界\",\"titlePolish\":\"Star Trek VI: Nieodkryta Kraina\",\"titleRussian\":\"Звёздный путь VI: Неоткрытая страна\",\"titleSerbian\":null,\"titleSpanish\":\"Star Trek VI: The Undiscovered Country\",\"stardateFrom\":9521.6,\"stardateTo\":9521.6,\"yearFrom\":2293,\"yearTo\":2293,\"usReleaseDate\":\"1991-12-06\"},{\"uid\":\"MOMA0000173722\",\"title\":\"Star Trek II: The Wrath of Khan\",\"mainDirector\":{\"uid\":\"STMA0000015366\",\"name\":\"Nicholas Meyer\"},\"titleBulgarian\":\"Стар Трек II: Гневът на Хан\",\"titleCatalan\":\"Star Trek II: La còlera d'en Khan\",\"titleChineseTraditional\":null,\"titleGerman\":\"Star Trek II: Der Zorn des Khan\",\"titleItalian\":\"Star Trek II: L'ira di Khan\",\"titleJapanese\":\"スタートレック2：カーンの逆襲\",\"titlePolish\":\"Star Trek II: Gniew Khana\",\"titleRussian\":\"Звёздный путь II: Гнев Хана\",\"titleSerbian\":null,\"titleSpanish\":\"Star Trek II: The Wrath of Khan\",\"stardateFrom\":8130.3,\"stardateTo\":8130.3,\"yearFrom\":2285,\"yearTo\":2285,\"usReleaseDate\":\"1982-06-04\"},{\"uid\":\"MOMA0000002045\",\"title\":\"Star Trek V: The Final Frontier\",\"mainDirector\":{\"uid\":\"STMA0000105959\",\"name\":\"William Shatner\"},\"titleBulgarian\":\"Стар Трек V: Последната граница\",\"titleCatalan\":\"Star Trek V: L'última frontera\",\"titleChineseTraditional\":null,\"titleGerman\":\"Star Trek V: Am Rande des Universums\",\"titleItalian\":null,\"titleJapanese\":\"スタートレック5：新たなる未知へ\",\"titlePolish\":\"Star Trek V: Ostateczna Granica\",\"titleRussian\":\"Звёздный путь V: Последний рубеж\",\"titleSerbian\":null,\"titleSpanish\":\"Star Trek V: The Final Frontier\",\"stardateFrom\":8454.1,\"stardateTo\":8454.1,\"yearFrom\":2287,\"yearTo\":2287,\"usReleaseDate\":\"1989-06-09\"},{\"uid\":\"MOMA0000002047\",\"title\":\"Star Trek III: The Search for Spock\",\"mainDirector\":{\"uid\":\"STMA0000023803\",\"name\":\"Leonard Nimoy\"},\"titleBulgarian\":\"Стар Трек III: В търсене на Спок\",\"titleCatalan\":\"Star Trek III: A la recerca d'en Spock\",\"titleChineseTraditional\":null,\"titleGerman\":\"Star Trek III: Auf der Suche nach Mr. Spock\",\"titleItalian\":\"Star Trek III: Alla ricerca di Spock\",\"titleJapanese\":\"スタートレック3：ミスター・スポックを探せ\",\"titlePolish\":\"Star Trek III: W poszukiwaniu Spocka\",\"titleRussian\":\"Звёздный путь III: В поисках Спока\",\"titleSerbian\":null,\"titleSpanish\":\"Star Trek III: The Search for Spock\",\"stardateFrom\":8210.3,\"stardateTo\":8210.3,\"yearFrom\":2285,\"yearTo\":2285,\"usReleaseDate\":\"1984-06-01\"}],\"characterSpecies\":[{\"uid\":\"SPMA0000026314\",\"name\":\"Human\",\"numerator\":1,\"denominator\":1}],\"characterRelations\":[],\"titles\":[{\"uid\":\"TIMA0000001294\",\"name\":\"Commander\",\"militaryRank\":true,\"fleetRank\":true,\"religiousTitle\":false,\"position\":false,\"mirror\":false}],\"organizations\":[]}}")
                        .contentType(MediaType.APPLICATION_JSON));
        CharacterList characterList = new CharacterList();
        List<Character> characters = new LinkedList<>();
        Character character = new Character();
        character.setUid("CHMA0000068639");
        characters.add(character);
        characterList.setCharacters(characters);
        String species = speciesService.getSpecies(characterList);
        Assert.assertNotNull(species);
        Assert.assertEquals("Human", species);
        mockServer.verify();
    }

    @Test
    public void speciesFindSpeciesTest2() {
        mockServer.expect(requestTo("http://stapi.co/api/v1/rest/character?uid=CHMA0000226446"))
                .andExpect(method(HttpMethod.GET))
                .andRespond(withStatus(HttpStatus.OK)
                        .body("{\"character\":{\"uid\":\"CHMA0000226446\",\"name\":\"Or'Eq\",\"gender\":null,\"yearOfBirth\":null,\"monthOfBirth\":null,\"dayOfBirth\":null,\"placeOfBirth\":null,\"yearOfDeath\":2256,\"monthOfDeath\":null,\"dayOfDeath\":null,\"placeOfDeath\":null,\"height\":null,\"weight\":null,\"deceased\":true,\"bloodType\":null,\"maritalStatus\":null,\"serialNumber\":null,\"hologramActivationDate\":null,\"hologramStatus\":null,\"hologramDateStatus\":null,\"hologram\":false,\"fictionalCharacter\":false,\"mirror\":false,\"alternateReality\":false,\"performers\":[],\"episodes\":[],\"movies\":[],\"characterSpecies\":[{\"uid\":\"SPMA0000005172\",\"name\":\"Klingon\",\"numerator\":1,\"denominator\":1}],\"characterRelations\":[{\"type\":\"Brother\",\"source\":{\"uid\":\"CHMA0000226446\",\"name\":\"Or'Eq\"},\"target\":{\"uid\":\"CHMA0000226445\",\"name\":\"Rejac\"}},{\"type\":\"Sibling\",\"source\":{\"uid\":\"CHMA0000226445\",\"name\":\"Rejac\"},\"target\":{\"uid\":\"CHMA0000226446\",\"name\":\"Or'Eq\"}}],\"titles\":[],\"occupations\":[],\"organizations\":[]}}")
                        .contentType(MediaType.APPLICATION_JSON));
        CharacterList characterList = new CharacterList();
        List<Character> characters = new LinkedList<>();
        Character character = new Character();
        character.setUid("CHMA0000226446");
        characters.add(character);
        characterList.setCharacters(characters);
        String species = speciesService.getSpecies(characterList);
        Assert.assertNotNull(species);
        Assert.assertEquals("Klingon", species);
        mockServer.verify();
    }

    @Test
    public void speciesFindSpeciesTest3() {
        mockServer.expect(requestTo("http://stapi.co/api/v1/rest/character?uid=CHMA0000029836"))
                .andExpect(method(HttpMethod.GET))
                .andRespond(withStatus(HttpStatus.OK)
                        .body("{\"character\":{\"uid\":\"CHMA0000029836\",\"name\":\"Jaryn\",\"gender\":\"F\",\"yearOfBirth\":null,\"monthOfBirth\":null,\"dayOfBirth\":null,\"placeOfBirth\":null,\"yearOfDeath\":null,\"monthOfDeath\":null,\"dayOfDeath\":null,\"placeOfDeath\":null,\"height\":null,\"weight\":null,\"deceased\":null,\"bloodType\":null,\"maritalStatus\":null,\"serialNumber\":null,\"hologramActivationDate\":null,\"hologramStatus\":null,\"hologramDateStatus\":null,\"hologram\":false,\"fictionalCharacter\":false,\"mirror\":false,\"alternateReality\":false,\"performers\":[{\"uid\":\"PEMA0000017957\",\"name\":\"Megan Gallagher\",\"birthName\":null,\"gender\":\"F\",\"dateOfBirth\":\"1960-02-06\",\"placeOfBirth\":null,\"dateOfDeath\":null,\"placeOfDeath\":null,\"animalPerformer\":false,\"disPerformer\":false,\"ds9Performer\":true,\"entPerformer\":false,\"filmPerformer\":false,\"standInPerformer\":false,\"stuntPerformer\":false,\"tasPerformer\":false,\"tngPerformer\":false,\"tosPerformer\":false,\"videoGamePerformer\":false,\"voicePerformer\":false,\"voyPerformer\":true}],\"episodes\":[{\"uid\":\"EPMA0000001607\",\"title\":\"Body and Soul\",\"titleGerman\":\"Körper und Seele\",\"titleItalian\":null,\"titleJapanese\":null,\"series\":{\"uid\":\"SEMA0000000029\",\"title\":\"Star Trek: Voyager\"},\"season\":{\"uid\":\"SAMA0000001755\",\"title\":\"VOY Season 7\"},\"seasonNumber\":7,\"episodeNumber\":7,\"productionSerialNumber\":\"255\",\"featureLength\":false,\"stardateFrom\":54238.3,\"stardateTo\":54238.3,\"yearFrom\":2377,\"yearTo\":2377,\"usAirDate\":\"2000-11-15\",\"finalScriptDate\":null}],\"movies\":[],\"characterSpecies\":[{\"uid\":\"SPMA0000009856\",\"name\":\"Lokirrim\",\"numerator\":1,\"denominator\":1}],\"characterRelations\":[{\"type\":\"Sibling\",\"source\":{\"uid\":\"CHMA0000069932\",\"name\":\"Lohden\"},\"target\":{\"uid\":\"CHMA0000029836\",\"name\":\"Jaryn\"}}],\"titles\":[],\"occupations\":[],\"organizations\":[]}}")
                        .contentType(MediaType.APPLICATION_JSON));
        CharacterList characterList = new CharacterList();
        List<Character> characters = new LinkedList<>();
        Character character = new Character();
        character.setUid("CHMA0000029836");
        characters.add(character);
        characterList.setCharacters(characters);
        String species = speciesService.getSpecies(characterList);
        Assert.assertNotNull(species);
        Assert.assertEquals("Lokirrim", species);
        mockServer.verify();
    }
}
